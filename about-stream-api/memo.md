
## ストリームの概要
- すべてのストリームクラスはstreamモジュールに属する以下の4つの基本抽象クラスのいずれかである
  - stream.Readable
  - stream.Writable
  - stream.Duplex
  - stream.Transform
- streamはEventEmitterのインスタンスでもある
  - つまりend,errorなどのイベントを生成する
  - 実用的なアプリケーションを作成する場合はすべてのストリームのerrorイベントに対してイベントリスナを登録すべき
    - *登録しないとどうなる？？*
- ストリームには処理するデータの形式に応じて2つのモードがある
  - バイナリモード
    - 文字列、Bufferなどの単位で処理する
  - オブジェクトモード
    - JavaScriptオブジェクト単位処理する場合
  - 補足：ストリームで処理されるデータの塊のことを「チャンク」と呼ぶことがある
    - 

## Readableストリーム
- データソースを表現する
- stream.Readableを使って実装する
- Readableストリームからデータを取得する方法には以下の2つがある
  - non-flowingモード
    - 標準のモード
    - readableイベントにリスナをアタッチする
    - 読み込み可能なチャンクが到着するとリスナが呼ばれる
    - チャンクはストリームのreadメソッドから読み込むことができる
      - readメソッドは内部バッファにデータ無いときにnullを返す
    - バイナリモードのReadableストリームの場合はsetEncodingでエンコードを指定することで文字列として読み込むことができる
  - flowingモード
    - 非標準のモード
    - non-flowingモードに比べてデータフローの制御の柔軟性がない
    - dataイベントにリスナをアタッチする
    - チャンク単位ではなく、データが到着した時点でリスナが呼ばれる

## Readableストリームの実装
- stream.Readableを継承する
- _readメソッドを実装する
  - _readメソッドは基底クラスから呼ばれる
  - _readメソッド内部ではthis.pushを呼び出し、内部バッファにデータを入れること
  - pushメソッドの戻り値がfalseの場合はそれ以上pushを呼び出さないこと
    - 内部バッファの使用量がhighWaterMarkに達するとpushメソッドはfalseを返す
  - readメソッドと間違えないこと。readメソッドはストリームのコンシューマから呼び出される

## Writableストリーム
- データの行き先を表現する
- stream.Writableを使って実装する
- writeメソッドでデータを書き込み、endメソッドで書き込むデータがもう無いことをストリームに伝える
- すべてのデータがストリームに書き込まれてフラッシュされるとfinishイベントが発火する
